<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><title>Test Mode | {{ assignment.title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>.watermark {position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); opacity: 0.05; font-size: 8rem; pointer-events: none;}</style>
</head>
<body class="bg-gray-100 h-screen flex flex-col overflow-hidden select-none" oncontextmenu="return false;">
    <div class="watermark">{{ student.username }}</div>
    <div class="bg-slate-900 text-white p-4 flex justify-between items-center shadow-md z-10">
        <div><h1 class="font-bold text-lg">{{ assignment.title }}</h1><p class="text-xs text-gray-400">{{ assignment.subject_name }}</p></div>
        <div class="flex items-center gap-6">
            <div id="timer" class="text-3xl font-mono font-bold text-red-500">00:00:00</div>
            <button onclick="submitTest()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded font-bold">Finish</button>
        </div>
    </div>
    <div class="flex-1 flex overflow-hidden z-10">
        <div class="w-1/2 h-full bg-gray-800 border-r border-gray-700">
            <iframe src="/student/download/{{ assignment.id }}#toolbar=0" class="w-full h-full"></iframe>
        </div>
        <div class="w-1/2 h-full bg-white p-8 overflow-y-auto">
            <form id="testForm" action="/student/submit-test/{{ assignment.id }}" method="POST" enctype="multipart/form-data" class="space-y-6">
                <input type="hidden" name="tab_switches" id="tab_switches" value="0">
                <textarea name="text_answer" rows="10" class="w-full p-4 border-2 rounded-xl" placeholder="Type answers here..."></textarea>
                <div class="border-2 border-dashed rounded-xl p-6 bg-gray-50 text-center">
                    <p class="font-bold">Or Upload Photo</p><input type="file" name="student_answer" class="mt-2">
                </div>
            </form>
        </div>
    </div>
    <script>
        let duration = {{ assignment.duration_minutes }} * 60;
        const timer = setInterval(() => {
            duration--;
            let h=Math.floor(duration/3600), m=Math.floor((duration%3600)/60), s=duration%60;
            document.getElementById('timer').innerText = `${h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
            if (duration <= 0) { clearInterval(timer); submitTest(); }
        }, 1000);
        function submitTest() { document.getElementById('testForm').submit(); }
        let switches = 0;
        document.addEventListener("visibilitychange", function() { if (document.hidden) { switches++; document.getElementById('tab_switches').value = switches; document.title = "⚠️ WARNING!"; } else { document.title = "Test Mode"; } });
    </script>
</body>
</html>